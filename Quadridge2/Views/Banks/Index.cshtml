@using Quadridge2.Helpers

@model ICollection<Quadridge2.Models.Bank>
@{
    ViewBag.Title = "Banks";
}

@Html.AddNewModal("Bank", "Add new bank", "Bank")

<div class='row'><button class='btn btn-primary' data-target='addBank' data-toggle='modal' id='btnShowModal'>New Bank</button></div>

@if (!Model.Any())
{
    <p> We do not have any Banks yet </p>
}
else
{
    <table id="banks" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var bank in Model)
            {
                <tr>
                    <td>@Html.ActionLink(bank.Name, "Details", "Banks", new { id = bank.Id }, null)</td>
                    <td>
                        <button data-bank-id="@bank.Id" class="btn btn-danger js-delete float-right"><i class="fa fa-trash-o fa-lg"></i></button>
                        <button class="btn btn-primary float-right">Edit</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@section scripts
{
    <script>

        var button;

        $("#btnShowModal").click(function () {
            button = $(this);
            $("#addBank").modal('show');
        });

        $("#btnHideModal").on("click", function () {
            $("#addBank").modal('hide');
        });

        $("#saveBank").click(function (e) {
            e.preventDefault();
            var Bank = {}
            Bank.Name = $("#Bank").val();
            var sendData = JSON.stringify(Bank)
            $.ajax(
                {
                    method: "post",
                    url: "/Banks/Save",
                    data: sendData,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (result) {
                        //toastr.success("Bank successfully added");
                        //$("#addBank").modal('hide');
                        window.location.href = result.Url;
                    },
                    fail: function () {
                        toastr.error("Failed to add bank.");
                    }
                }
            )
        });

        $(document).ready(function () {
            $("#banks").DataTable();

            $("#banks .js-delete").on("click", function () {
                var button = $(this);
                if (confirm("Are you sure you want to delete this bank?")) {
                    $.ajax({
                        url: "/Banks/Delete/" + button.attr("data-bank-id"),
                        method: "DELETE",
                        success: function (result) {
                            //console.log("Success");
                            window.location.href = result.Url;
                        }
                    }); // ajax
                }
            }); // on click function
        }); // ready function
    </script>
}


